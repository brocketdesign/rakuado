extends ../../base

block mainContent
  .container.mt-5
    h1.text-center.mb-4
      i.bi.bi-people-fill.me-2
      | リファラルポップアップ管理

    .row.mb-4
      .col-12
        .card.shadow-sm
          .card-header.bg-dark.text-white.d-flex.justify-content-between.align-items-center
            span
              i.bi.bi-list-ol.me-2
              | ポップアップ順序管理
            a.btn.btn-primary.btn-sm(href="/dashboard/app/referal")
              i.bi.bi-plus-circle.me-1
              | 新規作成
          .card-body
            form(action="/api/referal/order" method="post")
              table.table.table-hover.align-middle
                thead
                  tr
                    th(style="width: 80px") 順序
                    th Popup #
                    th 画像
                    th ターゲットURL
                    th 操作
                tbody
                  each popup in popups
                    tr
                      td
                        input.form-control.form-control-sm(type="number" name="order[]" value=popup.order min="1" max="2" style="width: 70px; display: inline-block;")
                        input(type="hidden" name="popup[]" value=popup.popup)
                      td #{popup.popup}
                      td
                        if popup.imageUrl
                          img(src=popup.imageUrl alt="画像" width="60" class="rounded shadow-sm")
                        else
                          span.text-muted 画像なし
                      td
                        a(href=popup.targetUrl target="_blank" class="text-decoration-none")
                          i.bi.bi-link-45deg.me-1
                          | #{popup.targetUrl}
                      td
                        a.btn.btn-outline-primary.btn-sm(
                          href=`/dashboard/app/referal?popup=${popup.popup}`
                          title="編集"
                        )
                          i.bi.bi-pencil-square
              .mt-3.text-end
                button.btn.btn-success(type="submit")
                  i.bi.bi-save.me-1
                  | 順序を保存

    .row
      .col-12
        .card.shadow-sm
          .card-header.bg-dark.text-white
            i.bi.bi-pencil-square.me-2
            | ポップアップ追加・編集
          .card-body
            form(action="/api/referal/save" method="post" enctype="multipart/form-data")
              input(type="hidden" name="popup" value=popupData.popup)
              if popupData.imageUrl
                .mb-2
                  img(src=popupData.imageUrl alt="現在の画像" width="100" class="rounded shadow-sm")
              .mb-3
                label.form-label(for="image") 画像アップロード
                input.form-control(type="file" name="image" id="image" accept="image/*")
                input(type="hidden" name="imageUrl" value=popupData.imageUrl)
              .mb-3
                label.form-label(for="targetUrl") ターゲットURL
                input.form-control(type="text" name="targetUrl" id="targetUrl" value=popupData.targetUrl)
              button.btn.btn-primary(type="submit")
                i.bi.bi-check-lg.me-1
                | 保存

  //- Bootstrap Icons CDN (if not already included in base)
  block append scripts
    script(src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.js")
